<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>EKANSH vs KAJU KATLI & KOPRA PATHI</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
<style>
  html, body { margin:0; padding:0; background:#000; height:100%; overflow:hidden; }
</style>
</head>
<body>
<script>
const config = {
  type: Phaser.AUTO,
  width: window.innerWidth,
  height: window.innerHeight,
  backgroundColor: "#111",
  physics: {
    default: 'arcade',
    arcade: { debug: false }
  },
  scene: { preload, create, update }
};
const game = new Phaser.Game(config);

let player, scoreText, gameOverText, score = 0, gameOver = false;

function preload() {
  const g = this.make.graphics({x:0,y:0,add:false});
  // player ball (EKANSH)
  g.fillStyle(0x00ff00);
  g.fillCircle(25,25,25);
  g.generateTexture('player',50,50);
  g.clear();
  // good ball (KOPRA PATHI)
  g.fillStyle(0x00ffff);
  g.fillCircle(20,20,20);
  g.generateTexture('good',40,40);
  g.clear();
  // danger ball (KAJU KATLI)
  g.fillStyle(0xff0000);
  g.fillCircle(20,20,20);
  g.generateTexture('danger',40,40);
  g.destroy();
}

function create() {
  const w = this.scale.width;
  const h = this.scale.height;

  gameOver = false;
  score = 0;

  // Player EKANSH
  player = this.physics.add.sprite(w/2, h-80, 'player').setBounce(0.8).setCollideWorldBounds(true);
  player.nameText = this.add.text(player.x, player.y-50, 'EKANSH', { fontSize:'20px', fill:'#00ff00' }).setOrigin(0.5).setDepth(5);

  // Touch Control
  this.input.on('pointermove', pointer => {
    if (!gameOver) player.x = pointer.x;
  });

  // Groups
  this.goodBalls = this.physics.add.group();
  this.badBalls = this.physics.add.group();

  // Spawn balls
  this.time.addEvent({ delay: 1000, loop: true, callback: ()=>spawnBall(this) });

  // Score text
  scoreText = this.add.text(20,20,'Score: 0',{ fontSize:'24px', fill:'#fff' });

  // Collisions
  this.physics.add.overlap(player, this.goodBalls, (p,ball)=>{
    if (ball.nameText) ball.nameText.destroy();
    ball.destroy();
    score += 10;
    scoreText.setText('Score: ' + score);
  });

  this.physics.add.overlap(player, this.badBalls, (p,ball)=>{
    if (ball.nameText) ball.nameText.destroy();
    ball.destroy();
    endGame(this);
  });
}

function spawnBall(scene){
  if (gameOver) return;
  const w = scene.scale.width;
  const isGood = Phaser.Math.Between(0,1);
  const x = Phaser.Math.Between(40, w-40);
  let ball, name;
  if (isGood){
    ball = scene.goodBalls.create(x, -20, 'good');
    name = scene.add.text(ball.x, ball.y-30, 'KOPRA PATHI', {fontSize:'16px', fill:'#0ff'}).setOrigin(0.5);
  } else {
    ball = scene.badBalls.create(x, -20, 'danger');
    name = scene.add.text(ball.x, ball.y-30, 'KAJU KATLI', {fontSize:'16px', fill:'#f55'}).setOrigin(0.5);
  }
  ball.body.setVelocityY(200 + Phaser.Math.Between(0,100));
  ball.nameText = name;
}

function update() {
  if (gameOver) return;

  // Update text positions and cleanup off-screen
  this.goodBalls.children.iterate(b => {
    if (b && b.nameText){
      b.nameText.setPosition(b.x,b.y-30);
      if (b.y > this.scale.height+50){
        b.nameText.destroy();
        b.destroy();
      }
    }
  });
  this.badBalls.children.iterate(b => {
    if (b && b.nameText){
      b.nameText.setPosition(b.x,b.y-30);
      if (b.y > this.scale.height+50){
        b.nameText.destroy();
        b.destroy();
      }
    }
  });

  // Keep EKANSH name above player
  if (player && player.nameText) player.nameText.setPosition(player.x, player.y-50);
}

function endGame(scene){
  if (gameOver) return;
  gameOver = true;

  // Stop all movement
  scene.goodBalls.setVelocityY(0);
  scene.badBalls.setVelocityY(0);

  // Destroy names
  scene.goodBalls.children.iterate(b => { if(b.nameText) b.nameText.destroy(); });
  scene.badBalls.children.iterate(b => { if(b.nameText) b.nameText.destroy(); });

  gameOverText = scene.add.text(scene.scale.width/2, scene.scale.height/2,
    'ðŸ’€ GAME OVER ðŸ’€\nTap to Restart',
    {fontSize:'30px',fill:'#fff',align:'center'}).setOrigin(0.5);

  scene.input.once('pointerdown', () => {
    scene.goodBalls.clear(true, true);
    scene.badBalls.clear(true, true);
    gameOverText.destroy();
    scene.scene.restart();
  });
}
</script>
</body>
</html>
